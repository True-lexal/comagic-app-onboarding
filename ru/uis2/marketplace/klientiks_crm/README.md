## Интеграция с Клиентикс CRM <br />  
 
Решение позволяет получать заявки оставленные клиентами в форме Онлайн-записи , загружать в наш кабинет записи(сделки) из Клиентикс CRM, а также передавать данные по звонкам из нашего ЛК в Клиентикс CRM.  
<br />   

**Какие данные передаются**<br />    

Данные получаемые по сделкам:  <br />
- сделки: сумма сделки, название, даты изменения и тд; 
- воронка продаж и ее этапы;
- контакты;
- ответственный менеджер;
- дополнительные поля.  <br />  

Данные получаемые по заявкам:  <br />

- контактные данные (имя,телефон,email);  
- дату и время создания; 
- данные сессии (рекламную кампанию, источник, UTM-метки и тд);  
- в случае отсутствия сессии, дефолтную РК или источник. <br />  
 <br />

Данные передаваемые по звонкам:  <br />

- открытие карточки клиента при входящем звонке;
- история телефонных вызовов;
- прослушивание записи разговора из CRM;
- исходящий звонок по клику из CRM.
 <br />

**Важно**: в Клиентикс CRM необходимо подключить один из тарифов "PRO+" или "APIdd" <br /> 
 <br />


## Подключение передачи сделок  <br />   

<details>
  <summary style="font-weight:bold;">  Шаги по подключению </summary> <br />
  
1.Заполните **учетные данные**. <br /> 

Для авторизации в Клиентикс и дальнейшей возможности совершать запросы к API, необходимо добавить :
- название
- account_id,  user_id и access_token от Клиентикс : Меню → Настройки → API
![image](klientiks_auth.jpg)
<br />

2.  Активируйте интеграцию. <br />  

3. **Настройте Webhook в Клиентикс CRM** <br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />

Инструкция по настройке Webhook [по ссылке](https://klientikscrm.helpdeskeddy.com/ru/knowledge_base/art/569/cat/29/administrativnaja-panel-dlja-sozdanija-uvedomlenij-webhook-po-sobitijam-v-sisteme)  
Пользователь с ролью Владелец может открыть административную панель [по ссылке](https://klientiks.ru/clientix/admin/eventHandlers) 

- Для событий “Запись клиента на прием” и “Онлайн-запись через виджет” в адрес для запроса указываются следующие значения:  
**Webhook url**?appointment_id={{#appointment}}{{id}}{{/appointment}}&status={{#new_data}}{{status}}{{/new_data}} ,   
где Webhook url - URL указанный в настройках интеграции

- Для события “Перенос визита, изменение длительности, изменение статуса” в адрес для запроса указываются следующие значения: 
**Webhook url**?appointment_id={{#new_data}}{{id}}{{/new_data}}&status={{#new_data}}{{status}}{{/new_data}} ,   
где Webhook url - URL указанный в настройках интеграции

![image](klientiks_hook_1.gif)

</details>   
 <br />
 
4. **Передача сделок** — при прожатии будет включена интеграция по передаче сделок и будут выведены дополнительные настройки. <br /> 

5. **Сотрудник-исполнитель /автор записи** — определяет какая сущность будет использоваться в качестве ответственного сотрудника: не прожатый маркер - сотрудник-испольнитель , прожаты - автор записи.
<br />

6.  **Учитывать абонемент в сделке** - если включена настройка, в случае визита по абонементу сумма сделки не учитывается.

7. Нажмите **сохранить**. <br />

После подключения интеграции сделки будут попадать в  Сырые данные -> Сделки.  <br />
Для проверки корректности работы интеграции создайте тестовую сделку(запись) в Клиентикс. <br />

</details> 
<br />
<br /> 



## Подключение интеграции с Онлайн-виджетом <br />  

<details>
  <summary style="font-weight:bold;">  Шаги по подключению </summary> <br />


1. Заполните **учетные данные**. <br /> 

**Авторизация в Клиентикс CRM** <br />  

Для авторизации в Клиентикс и дальнейшей возможности совершать запросы к API, необходимо добавить :

- название
- account_id,  user_id и access_token от Клиентикс : Меню → Настройки → API

![image](klientiks_auth.jpg)
<br />  

2. Активируйте интеграцию.<br />  

3. Настройте Webhook в Клиентикс CRM** <br />

<details>
  <summary style="font-weight:bold;"> Подробнее </summary> <br />

Инструкция по настройке Webhook [по ссылке](https://klientikscrm.helpdeskeddy.com/ru/knowledge_base/art/569/cat/29/administrativnaja-panel-dlja-sozdanija-uvedomlenij-webhook-po-sobitijam-v-sisteme)  
Пользователь с ролью Владелец может открыть административную панель [по ссылке](https://klientiks.ru/clientix/admin/eventHandlers) 
 <br />
 
- Выбирается событие “Онлайн-запись через виджет”   
- В адрес для запроса указываются следующие значения:  
**Webhook url**?appointment_id={{#appointment}}{{id}}{{/appointment}}&status={{#new_data}}{{status}}{{/new_data}} ,   
где Webhook url - URL указанный в настройках интеграции

![image](klientiks_hook_2.gif)

</details> 

 <br />

4. **Передача заявок** — при прожатии будет включена интеграция по передаче заявок и будут выведены дополнительные настройки.  <br />

5.  **Передавать тег по источнику ВОЗ** — при прожатии на заявку будет проставляться тег из поля источник ВОЗ. Параметр настраивается персонально под каждого клиента в Клиентикс , инструкция [по ссылке](https://klientikscrm.helpdeskeddy.com/ru/knowledge_base/art/623/cat/55/)     <br />
В техническое имя поля обязательно указать "lead"  <br />

6.  **Тип трафика** — необходимо выбрать какую сущность использовать для обращений без сессии. По умолчанию выбран Источник. <br />  
В зависимости от выбранного **типа трафика** выводится либо список источников и сайтов  из личного кабинета клиента, либо список рекламных кампаний. Необходимо указать какой **источник и сайт/рекламную кампанию** используем в случае отсутствия сессии. <br />   

7. Нажмите сохранить.  <br />

После подключения интеграции заявки будут попадать в  Сырые данные -> Обращения и цели.   <br />
Для проверки корректности работы интеграции оставьте тестовую запись в виджете Клиентикс.  <br />

</details> 
 <br />
 <br />

## Подключение телефонии   <br />

<details>
 <summary style="font-weight:bold;"> Шаги по подключению </summary> <br />


1.Заполните **учетные данные**. <br /> 

Для авторизации в Клиентикс и дальнейшей возможности совершать запросы к API, необходимо добавить :
- название
- account_id,  user_id и access_token от Клиентикс : Меню → Настройки → API
![image](klientiks_auth.jpg)
<br />

2.  Активируйте интеграцию. <br />

3.  Нажмите **сохранить** <br />
4.  **Настройка исходящих звонков**  <br />

- Скопируйте код из поля **Данные виджета (в JSON)**  и перейдите в кабинет Клиентикс. <br />
- В меню Клиентикс войдите в раздел **Настройки**. <br />
- Перейдите в раздел **Виджеты**, поставьте галку в поле **Включить виджеты** и в разделе **Виджеты IP-телефонии** выберите **UIS** <br />

![image](klientix_vidget.jpg)

<br />

- Во всех трёх виджетах в поле «Данные виджета (в JSON)» вставьте скопированный код из кабинета UIS. <br />
- Нажмите **Сохранить**. <br />

Пример заполнения <br />

![image](klientix_vidget3.jpg)
<br />
 
5.  **Настройка сотрудников** <br />

Сотрудники не копируются автоматически из одного сервиса в другой. Это значит, что сотрудники должны быть созданы вручную и в личном кабинете UIS, и в сервисе Клиентикс.  <br />

- В личном кабинете UIS обязательно укажите внутренний номер у всех сотрудников. <br />
- Войдите в Клиентикс под ролью «Владелец», в новом окне откройте [ссылку](https://klientiks.ru/clientix/admin/dynamicFields) и добавьте поля:
  - **Имя поля**: itool_labs_voip_internal_number  
   **Метка**: Внутренний номер сотрудника  
   **Модель**: Сотрудники  
   **Сценарий**: editEmployee  
   **Тип поля**: text   <br />
<br />
   
  Кликните **Сохранить**  

<br />

 - **Имя поля**: itool_labs_voip_internal_number  
    **Метка**: Внутренний номер сотрудника  
    **Модель**: Сотрудники  
    **Сценарий**: edit  
    **Тип поля**: text <br />
 <br />
 
   Кликните **Сохранить**
 <br />
 
 -  **Имя поля**: itool_labs_voip_internal_number  
    **Метка**: Внутренний номер сотрудника  
    **Модель**: Сотрудники  
    **Сценарий**: editOwner  
    **Тип поля**: text <br />
 
    <br /> 
    
    Кликните **Сохранить**
 
 <br />   


![image](klientix_employee.jpg)
<br />


- В меню Клиентикс, раздел **Сотрудники** задайте всем требуемым сотрудникам те же внутренние номера, что указывали в кабинете UIS.

Для проверки работы интеграции на тестовых звонках проверьте работы пунктов указаных в **Данные передаваемые по звонкам**. <br />
Если после всех настроек звонки в Клиентикс не появляются, проверьте, совпадают ли внутренние номера сотрудников в Клиентикс и UIS.


 </details> 

