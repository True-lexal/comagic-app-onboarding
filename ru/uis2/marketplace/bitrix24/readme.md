# Интеграция с Битрикс24

## ВАЖНО! 
* Для корректной работы интеграции, необходимо, чтобы у каждого сотрудника было занесено поле "Фамилия" в профиле портала Битрикс24<br />
* Не забудьте установить приложение UIS 2.0 в маркетплейсе Битрикс24 <br />

____

## После активации вам будут доступно:

### Телефония

- Всплывающие уведомления о звонках;
- Звонок в 1 клик из Битрикс24 (IP телефония или расширение для браузера);
- Обратный звонок из форм на сайте;
- Сохранение истории и записей звонков в карточке Битрикс24;<br />

### Чаты и офлайн заявки

- Создание сущностей при получении чатов и передача содержимого переписки в сущности Битрикс24;
- Создание сущностей при получении офлайн заявок и передача содержимого заявки в сущности Битрикс24;<br />

### Общие
- Фильтрация звонков, чатов, офлайн сообщений по различным сценариям;
- Фильтрация ответственных за сущности по различным сценариям;
- Шаблоны названий для вновь созданных сущностей;
- Передача дополнительных полей в сущности Битрикс24;
- Оповещения о созданных сущностях;<br />

____
## Настройка интеграции
<details>
  <summary style="font-weight:bold;"> Установка </summary> <br />

Существует два способа установки интеграции с Битрикс24:<br />

1. установить интеграцию через [Личный кабинет UIS](https://go.uiscom.ru/marketplace/integration_list/bitrix24), нажав кнопку "Подключить интеграцию".
    - Далее необходимо завести учетные данные: название (может быть любым) и адрес вашего портала Битрикс24.

2. Из маркетплейса Битрикс24.</br> После установки приложения откроется окно с приглашением завершить установку в ЛК UIS.
    - При установке из маркетплейса Битрикс24 заводить учетные данные не нужно, они будут созданы автоматически.

</details>
<details>
  <summary style="font-weight:bold;"> Настройка </summary> <br />

1. В окне настроек интеграции 3 вкладки: Главная, Телефония, Чаты и офлайн завки<br />

![01_settings.png](01_settings.png)

> Важно! 
> 
> После внесения настроек в любой из вкладок необходимо нажать кнопку "Сохранить" внизу экрана, а затем уже переходить к следующей вкладке
> 
> Во каждой из вкладок есть флажок "Интеграция активна" для корректной работы необходимой части интеграции нужно следить, чтобы этот флажок был активирован.
> 
> Флажок "Интеграция Активна" всегда должен быть включен во вкладке Главная

2. Выбрать необходимые учетные данные, для доступа к настройкам интеграции.<br />
</details>

<details>
  <summary style="font-weight:bold;"> Вкладка Главная </summary> <br />

![02_main.png](02_main.png)

В данной вкладке доступна кнопка Ручная синхронизация - это синхронизация сущностей, необходимая для работы интеграции<br />

</details>

<details>
  <summary style="font-weight:bold;"> Вкладка Телефония </summary> <br />

#### Настройки телефонии

1. Режим работы телефонии<br />
- IP Телефония
- WebRTC виджет (расширение Chrome UIS)<br />

#### Входящие звонки

1. Переадресация на персонального менеджера
> В случае, если настроен сценарий телефонии Поиск персонального менеджера звонок будет отправлен ответственному сотруднику из Битрикс24.<br />

2. Фильтрация ответственных<br />

![04_responsible_2.png](04_responsible_2.png)

![04_responsible_1.png](04_responsible_1.png)


3. Ответственный по-умолчанию, во всех остальных случаях.<br />

#### Исходящие звонки<br />

1. Ответственный по-умолчанию в случае неуспешного звонка.<br />
2. Назначение ответственного первого/последнего разговаривавшего сотрудника.<br />

#### Шаблоны названий сущностей в CRM<br />

1. Выбор типа звонка (входящий/исходящий)<br />
2. Выбор результата звонка (пропущенный/не принятый)<br />
3. Собственный шаблон для названия сущности.<br />

#### Фильтрация<br />

Отдельно фильтруются входящие и исходящие вызовы. Также можно группировать фильтры при помощи операторов И/ИЛИ<br />

![03_filters.png](03_filters.png)

#### Сопоставление полей<br />

Можно сопоставить поле из API UIS с полем Битрикс24.<br />

![04_mapping.png](04_mapping.png)

#### Прочие настройки<br />

1. Добавлять сообщение о пропущенном звонке в чат открытых линий<br />
2. Передавать записи разговора<br />
3. Передавать номера, как источник обращения<br />
4. Активация обратного звонка из форм Битрикс24<br />

![05_other.png](05_other.png)

</details>

<details>
  <summary style="font-weight:bold;"> Вкладка Чаты </summary> <br />
    
#### Чаты

1. Выбор канала чатов, которые будет отслеживать интеграция<br />
2. Фильтр ответственных за чаты<br />
3. Ответственный по-умолчанию во всех остальных случаях<br />
4. Выбор создавать ли сущности при первичном или повторном обращении.<br />
5. Выбор какого типа сущности будут создаваться<br />
- Лид/Сделка
- Дело
- Лид/Сделка + Дело
6. Создание сущности при начале или завершении чатов оператором.<br />
7. Выбор передавать ли чаты без контактных данных.<br />
8. Выбор отправлять ли уведомления ответственному при создании сущности.<br />

#### Офлайн заявки

1. Фильтр ответственных за офлайн заявки<br />
2. Ответственный по-умолчанию во всех остальных случаях.<br />
3. Выбор создавать ли сущности при первичном или повторном обращении.<br />
4. Выбор какого типа сущности будут создаваться<br />
- Лид/Сделка
- Дело
- Лид/Сделка + Дело
5. Создание сущности при начале или завершении чатов оператором.<br />
6. Выбор отправлять ли уведомления ответственному при создании сущности.<br />

#### Фильтрация<br />

Отдельно фильтруются чаты и офлайн заявки. Также можно группировать фильтры при помощи операторов И/ИЛИ<br />

#### Сопоставление полей<br />

Можно сопоставить поле из API UIS с полем Битрикс24.<br />

![04_mapping.png](04_mapping.png)

</details>
